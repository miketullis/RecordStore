@model RecordStore.Data.EF.Album

@{
    ViewBag.Title = "Details | " + @Model.AlbumName;
}

<div id="rrWrapper">



    <div class="row">
        <div col-md-5 style="padding-right: 5em;">
            <img src="~/Content/assets/images/albumImages/@Model.AlbumImage" alt="@Model.AlbumName Cover" title="@Model.AlbumName Cover" id="albumArt" />
        </div>

        <div col-md-7>
            <dl class="dl-horizontal">
                <dd>
                    <h2>@Html.DisplayFor(model => model.AlbumName)</h2>
                </dd>
                <hr />
                <dd>
                    @* In a Details View, we have only passed a single Album object from the controller to this view.  When referencing the Album, we call  it with Model (* note, capital M)*@
                    @foreach (var artist in Model.AlbumArtist)
                    {
                        if (artist.PrimaryArtist != null)
                        {
                            if ((bool)artist.PrimaryArtist)
                            {
                                <div>
                                    <span style="font-weight: bold;">
                                        Artist@(Model.AlbumArtist.Count == 1 ? ":" : "s:" )
                                    </span>
                                    @artist.Artist.ArtistName
                                </div>
                            }
                        }
                    }

                    @* Create comma separated list Of non-primary Artists.  Add "feat." before list *@
                    <div style="word-wrap: normal;">
                        @if (Model.AlbumArtist.Count > 1)
                        {
                            <span>Featuring: </span>
                        }
                        @foreach (var artist in Model.AlbumArtist.OrderBy(x => x.Artist.ArtistName))
                        {
                            if ((bool)artist.PrimaryArtist == false)
                            {
                                if (Model.AlbumArtist.ToList().IndexOf(artist) == Model.AlbumArtist.Count - 2)
                                {
                                    @artist.Artist.ArtistName
                                }
                                else
                                {
                                    @artist.Artist.ArtistName<span>, </span>
                                }
                            }
                        }
                    </div>
                </dd>

                <dd>
                    <span class="font-weight-bold">Year:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.Year)
                </dd>
                <dd>
                    <span class="font-weight-bold">Format:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.Num) @Html.DisplayFor(model => model.Format.FormatType)@(Model.Num == 1 ? "" : "s")
                    @(Model.Tracks >= 1 ? ", " : " ") @Html.DisplayFor(model => model.Tracks)
                    @(Model.Tracks == 1 ? "Track" : Model.Tracks > 1 ? "Tracks" : "" ) @*ternary operator to display track info*@
                </dd>
                <dd>
                    @* Create comma separated list Of non-primary Artists.  Add "feat." before list *@
                    <div style="word-wrap: normal;">
                        <span class="font-weight-bold">Genre:&nbsp;&nbsp;</span>
                        @foreach (var genre in Model.AlbumGenre.OrderBy(x => x.Genre.GenreName))
                        {
                            if (Model.AlbumGenre.ToList().IndexOf(genre) == Model.AlbumGenre.Count - 2)
                            {
                                @genre.Genre.GenreName
                            }
                            else
                            {
                                @genre.Genre.GenreName<span>, </span>
                            }

                        }
                    </div>
                </dd>
                <dd>
                    <span class="font-weight-bold">Label:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.Label.LabelName)
                </dd>
                <dd>
                    <span class="font-weight-bold">Catalog No.:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.CatalogNum)
                </dd>
                <dd>
                    <span class="font-weight-bold">Country:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.Label.Country)
                </dd>


                <hr />
                <dd>
                    <span class="font-weight-bold">Status:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.AlbumStatus.AlbumStatusName)
                </dd>
                <dd>
                    <span class="font-weight-bold">Units In Stock:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.UnitsInStock)
                </dd>
                <dd>
                    <span class="font-weight-bold">Compilation:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.CompilationAlbum)
                </dd>
                <dd>
                    <span class="font-weight-bold">Still In Print:&nbsp;&nbsp;</span>
                    @Html.DisplayFor(model => model.IsInPrint)
                </dd>

                <hr />
                <dt>
                    @Html.DisplayNameFor(model => model.Description):
                </dt>
                <dd>
                    @Html.DisplayFor(model => model.Description)
                </dd>

                <hr />
                <dt>
                    @Html.DisplayNameFor(model => model.Price):
                </dt>

                <dd>
                    <h3>@Html.DisplayFor(model => model.Price)</h3>
                </dd>

            </dl>
        </div>
    </div>

    @* "Add To Cart" fuctionality *@
    @using (Html.BeginForm("AddToCart", "Album", new { albumID = Model.AlbumID }, FormMethod.Post))
    {
        if (Model.UnitsInStock == 0)
        {
            <div>
                <input value="Currently Unavailible" class="btn btn-danger" />
            </div>
        }
        else
        {
            @Html.HiddenFor(a => a.AlbumID)
            <span class="label">Quantity: </span>
            @Html.TextBox("qty", 1, new { @class = "form-control", @style = "max-width: 50px; display: inline;", onkeyup = "checkQty()" })

            <div id="btnSubmit">
                <input type="submit" value="Add To Cart" class="btn btn-dark" />
            </div>
        }

        @Html.ActionLink("Back to Albums", "Index", "", new { @class = "btn btn-dark" })
        if (User.IsInRole("Admin"))
        {
            <span></span>@Html.ActionLink("Edit", "Edit", new { id = Model.AlbumID }, new { @class = "btn btn-dark" })
            <span></span>@Html.ActionLink("Delete", "Delete", new { id = Model.AlbumID }, new { @class = "btn btn-dark" })
        }
    }
</div>



@section scripts{
    <script>
        //On page load, store the units in stock as a JS variable for use in the function
        let uis = @Model.UnitsInStock;

        //Use some JS for this since it's dependent upon the user typing in the quantity for the cart.  The function fires onkeyup -  after someone types something into the textbox for quantity, this function executes
        function checkQty() {
            //textbox value
            //alert("Check QTY")
            let qty = document.getElementById("qty").value;
            console.log(uis);
            console.log(Qty);

            //div surrounding button - use this to modify innerHTML depending on stock QTY
            let btnDiv = document.getElementById("btnSubmit");
            if (uis >= qty) {
                 btnDiv.innerHTML='<input type="submit" value="Add To Cart" class="btn btn-dark" />';
            }
            else
            {
            btnDiv.innerHTML='<span class="text-danger">Insufficient quantity in stock.<br/> Please select a lower quantity, or choose a different title.</span>';
            }
        }
    </script>
}